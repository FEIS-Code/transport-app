<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Daily Transport Report</title>
    <link rel="stylesheet" href="styles.css"> 
</head>
<body>
    <div class="container">
        <header>
            <h1>Daily Transport Report</h1>
            <p id="sub-header">Step 1: Select Date</p>
        </header>

        <form id="transport-form">
            <section id="step-date">
                <label for="date">Report Date:</label>
                <input type="date" id="date" required>
                <button type="button" id="btn-next-trip">Next</button>
            </section>
            
            <section id="step-trip" class="hidden">
                <button type="button" class="btn-trip" data-trip="Morning">
                    ‚òÄÔ∏è Morning
                </button>
                <button type="button" class="btn-trip" data-trip="Afternoon">
                    üåô Afternoon
                </button>
            </section>

            <section id="step-route" class="hidden">
                <div class="grid-container">
                    </div>
            </section>

            <section id="step-details" class="hidden">
                <label for="student-count">Number of Students:</label>
                <input type="number" id="student-count" required>
                
                <label for="time">Arrival/Departure Time:</label>
                <input type="time" id="time" required>
                
                <label for="concerns">Delays or Concerns (Optional):</label>
                <textarea id="concerns" rows="3"></textarea>
                
                <button type="submit" id="btn-submit">Submit Log</button>
            </section>
        </form>
        
        <div id="status-message"></div>
    </div>

    <script>
    const WEB_APP_URL = "https://script.google.com/macros/s/AKfycbwl_XeoRfHEtJksbBQ04fkZ4HxneLLWhGb_KyFTwOna2u1yPShZSYPBS7bC21cMPvPiGQ/exec"; 

    const formData = { date: "", route: "", trip: "" };

    const form = document.getElementById("transport-form");
    const subHeader = document.getElementById("sub-header");
    const statusMessage = document.getElementById("status-message");

    const stepDate = document.getElementById("step-date");
    const stepRoute = document.getElementById("step-route");
    const stepTrip = document.getElementById("step-trip");
    const stepDetails = document.getElementById("step-details");

    const dateInput = document.getElementById("date");
    const nextTripButton = document.getElementById("btn-next-trip");

    // Default date = today
    dateInput.valueAsDate = new Date();
    nextTripButton.disabled = false;

    dateInput.addEventListener("input", () => {
        nextTripButton.disabled = !dateInput.value;
    });

    // --- STEP 1: Date ‚Üí Next ‚Üí ROUTE ---
    nextTripButton.addEventListener("click", () => {
        formData.date = dateInput.value;
        if (!formData.date) {
            alert("Please select a date.");
            return;
        }
        stepDate.classList.add("hidden");
        stepRoute.classList.remove("hidden");
        subHeader.textContent = "Step 2: Select Route";
    });

    // --- STEP 2: Route Selection ---
    const routeGrid = document.querySelector("#step-route .grid-container");
    for (let i = 1; i <= 14; i++) {
        const routeBtn = document.createElement("button");
        routeBtn.type = "button";
        routeBtn.className = "btn-route";
        routeBtn.textContent = `R${i}`;
        routeBtn.dataset.route = `R${i}`;

        routeBtn.addEventListener("click", () => {
            formData.route = routeBtn.dataset.route;
            stepRoute.classList.add("hidden");
            stepTrip.classList.remove("hidden");
            subHeader.textContent = `Step 3: Select Trip (${formData.route})`;
        });

        routeGrid.appendChild(routeBtn);
    }

    // --- STEP 3: Morning / Evening Selection ---
    document.querySelectorAll(".btn-trip").forEach(button => {
        button.addEventListener("click", () => {
            formData.trip = button.dataset.trip;
            stepTrip.classList.add("hidden");
            stepDetails.classList.remove("hidden");
            subHeader.textContent = `Step 4: Details (${formData.route} - ${formData.trip})`;
        });
    });

    // --- STEP 4: Submit Form ---
    form.addEventListener("submit", async (e) => {
        e.preventDefault();
        const submitButton = document.getElementById("btn-submit");
        submitButton.disabled = true;
        submitButton.textContent = "Submitting...";

        const finalData = {
            ...formData,
            studentCount: document.getElementById("student-count").value,
            time: document.getElementById("time").value,
            concerns: document.getElementById("concerns").value
        };

        try {
            await fetch(WEB_APP_URL, {
                method: "POST",
                mode: "no-cors",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify(finalData),
            });
            showStatus("Log saved successfully!", "success");
            resetForm();
        } catch (error) {
            console.error("Error:", error);
            showStatus("Error saving log. Please try again.", "error");
        } finally {
            submitButton.disabled = false;
            submitButton.textContent = "Submit Log";
        }
    });

    function showStatus(message, type) {
        statusMessage.textContent = message;
        statusMessage.className = type;
    }

    function resetForm() {
        form.reset();
        dateInput.valueAsDate = new Date();
        nextTripButton.disabled = false;
        formData.route = "";
        formData.trip = "";
        stepDetails.classList.add("hidden");
        stepTrip.classList.add("hidden");
        stepRoute.classList.add("hidden");
        stepDate.classList.remove("hidden");
        subHeader.textContent = "Step 1: Select Date";
        showStatus("Form reset for next entry.", "");
    }
</script>

</body>
</html>
